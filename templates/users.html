{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</title>
    <link rel="stylesheet" href="{% static 'users.css' %}">
</head>
<body>
    <h1>–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h1>

    <div class = "arrow">
        <a href="/" class="back-arrow">ü¢§</a>
    </div>    

    <div id="users-container">
        <!-- –ü–∞–Ω–µ–ª–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏) -->
    </div>

    <script>
        async function fetchUserData() {
            try {
                const response = await fetch('/api/users/');
                const data = await response.json();

                const container = document.getElementById('users-container');
                container.innerHTML = '';

                for (const user in data) {
                    const userData = data[user];

                    const userPanel = document.createElement('div');
                    userPanel.classList.add('panel');
                    userPanel.innerHTML = `
                        <div class="label">${user}</div>
                    `;

                    const detailsPanel = document.createElement('div');
                    detailsPanel.classList.add('details');
                    detailsPanel.innerHTML = `
                        <div class="value">Upload: ${userData.upload} GB</div>
                        <div class="value">Download: ${userData.download} GB</div>
                        <div class="value">Traffic: ${userData.traffic} GB</div>
                    `;

                    userPanel.addEventListener('click', function () {
                        if (detailsPanel.style.display === 'block') {
                            detailsPanel.style.display = 'none';
                        } else {
                            detailsPanel.style.display = 'block';
                        }
                    });

                    userPanel.appendChild(detailsPanel);
                    container.appendChild(userPanel);
                }
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', err);
            }
        }

        setInterval(fetchUserData, 600000);
        fetchUserData();
    </script>
</body>
</html>
